/**
 * A websocket provider for angular

 * @version v0.1.1
 * @date 2014-03-27 00:41:47 GMT+0100
 * @link https://github.com/instabledesign/angular-websocket
 * @license GNU GPL v2
 */
"use strict";var websocketModule=angular.module("websocket",[]).constant("JSONRPC_VERSION","2.0").provider("$websocket",["JSONRPC_VERSION",function(a){var b=this;b.path=null,b.$get=["$rootScope","$q",function(c,d){b.requestSended={},b.request_id=0;var e=new WebSocket(b.path);return e.onopen=function(a){c.$emit("websocket.connected",a)},e.onclose=function(a){c.$emit("websocket.closed",a)},e.onmessage=function(a){var d=JSON.parse(a.data);if(b.requestSended.hasOwnProperty(d.id)){var e=b.requestSended[d.id].defer,f=d.error?e.reject(d.error):e.resolve(d);c.$apply(f)}c.$emit("websocket."+d.method,d),c.$emit("websocket.message",d)},e.onerror=function(a){c.$emit("websocket.error",a)},e.toSend=function(a){e.send(JSON.stringify(a)),c.$emit("websocket.send",a)},b.getConnection=function(){return e},b.request=function(c){var f=d.defer();return++b.request_id,b.requestSended[b.request_id]={defer:f,request:c,time:new Date},c.id=b.request_id,c.jsonrpc=a,e.toSend(c),f.promise},b.close=function(){e.close()},b}]}]);